<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Status</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body.status-page {
      padding: 2rem;
      box-sizing: border-box;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .status-heart,
    .status-sad {
      display: none;
      width: 80px;
      height: 80px;
      margin: 0 auto 1.25rem;
      object-fit: contain;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    .status-heart.visible,
    .status-sad.visible {
      display: block;
    }

    .status-page .status-message {
      font-size: clamp(1.25rem, 4vw, 1.75rem);
      text-align: center;
      margin: 0;
    }
  </style>
</head>

<body class="screen status-page">
  <img id="status-heart" class="status-heart" src="gifs/heart.gif" alt="" />
  <img id="status-sad" class="status-sad" src="gifs/sad.gif" alt="" />
  <p id="status-message" class="status-message">Loadingâ€¦</p>

  <div class="credits-bottom-right">
    <a href="https://nukochannel.neocities.org" target="_blank" rel="noopener" class="hotlink-nuko" title="NUko">
      <span class="hotlink-nuko-label">cats from</span>
      <img src="https://nukochannel.neocities.org/NukoChannelButton.gif" alt="NUko" />
    </a>
    <div class="watermark-nikkon" aria-label="Made by Nikkon">
      <p class="watermark-nikkon-text">made by Nikkon</p>
      <div class="watermark-nikkon-links">
        <a href="https://github.com/nikkon404/be-my-valentine" target="_blank" rel="noopener" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
          </svg>
        </a>
        <a href="https://linktr.ee/xnikkon" target="_blank" rel="noopener" title="Linktree">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M7.953 15.066c-.08.163-.08.324-.08.486.08.17.08.34.16.51.08.162.16.324.24.486.08.162.16.34.24.494.08.162.16.324.24.486.08.162.16.324.24.486.08.162.16.324.24.486l.24.486c.08.08.16.162.24.242.08.08.16.162.24.242.08.08.16.162.32.242.08.08.16.162.24.242.08.08.16.162.32.242.08.08.16.162.32.242.08.08.16.162.32.242.16.08.24.162.4.242.08.08.16.162.32.242.08.08.16.162.32.242.32.162.64.324 1.04.486.4.162.8.324 1.2.486.08 0 .16.08.32.08.4.08.8.162 1.2.162.08 0 .16 0 .32-.08.4-.08.8-.162 1.2-.324.08 0 .16-.08.24-.08.4-.162.8-.324 1.12-.486.32-.162.64-.324.96-.486.08-.08.16-.08.24-.162.32-.162.56-.324.88-.486.08-.08.16-.08.24-.162.32-.162.56-.324.88-.486.08-.08.16-.162.24-.242.08-.08.16-.162.24-.242.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.324.08-.08.16-.162.24-.486.08-.162.08-.324.16-.486.08-.162.08-.324.16-.486.08-.324.08-.648.08-.972 0-.324 0-.648-.08-.972 0-.324-.08-.648-.16-.972-.08-.324-.16-.648-.24-.972-.08-.324-.16-.648-.32-.972-.08-.324-.16-.648-.24-.972-.08-.162-.16-.324-.24-.486-.08-.162-.16-.324-.24-.486-.4-.486-.8-.972-1.28-1.458-.48-.486-1.04-.972-1.6-1.458-.08-.08-.16-.162-.24-.242-.08-.08-.16-.162-.24-.242-.56-.486-1.2-.972-1.84-1.458-.64-.486-1.36-.972-2.08-1.458-.08-.08-.16-.08-.24-.162-.72-.486-1.52-.972-2.32-1.458-.08 0-.16-.08-.24-.08-.8-.486-1.6-.972-2.4-1.458-.08 0-.16-.08-.24-.08-.8-.324-1.6-.648-2.4-.972-.8-.324-1.6-.648-2.4-.972-.08 0-.16-.08-.24-.08-.8-.324-1.6-.486-2.4-.648-.8-.162-1.6-.324-2.4-.486-.08 0-.16 0-.24-.08-.8-.162-1.6-.162-2.4-.324-.8-.08-1.6-.162-2.4-.162-.08 0-.16 0-.24.08-.8.08-1.6.162-2.4.324-.08 0-.16.08-.24.08-.8.162-1.6.324-2.4.486-.08.08-.16.08-.24.162-.8.162-1.6.324-2.4.486-.08.08-.16.162-.24.162-.8.324-1.6.486-2.4.648-.08.08-.16.162-.24.162-.8.324-1.6.486-2.4.648-.08.08-.16.162-.24.162-.72.324-1.44.486-2.16.648-.72.162-1.44.324-2.16.324-.08 0-.16.08-.32.08-.72.08-1.44 0-2.16-.08-.72-.08-1.44-.162-2.16-.324-.08 0-.16-.08-.24-.08-.72-.162-1.44-.324-2.16-.486-.08-.08-.16-.08-.24-.162-.72-.162-1.44-.324-2.16-.486-.08-.08-.16-.162-.24-.162-.72-.324-1.44-.486-2.16-.648-.08-.08-.16-.162-.24-.162-.72-.324-1.44-.486-2.16-.648-.08-.08-.16-.162-.24-.162-.64-.324-1.36-.486-2-.648-.64-.162-1.36-.324-2-.486-.08-.08-.16-.162-.24-.242C.6 8.4.52 8.238.44 8.076.36 7.914.28 7.752.2 7.59.12 7.428.04 7.266 0 7.104v-.486c.04-.162.12-.324.2-.486.08-.162.16-.324.24-.486.08-.162.16-.324.24-.486.08-.162.16-.324.24-.486.64-.972 1.36-1.944 2.16-2.916.8-.972 1.68-1.944 2.56-2.826.08-.08.16-.162.24-.242.88-.972 1.84-1.854 2.8-2.736.96-.882 1.92-1.764 2.88-2.526.08-.08.16-.08.24-.162 1-.882 2.08-1.674 3.2-2.376 1.12-.702 2.24-1.314 3.44-1.836.08 0 .16-.08.24-.08 1.2-.522 2.4-.954 3.6-1.296 1.2-.342 2.4-.594 3.6-.756.08 0 .16 0 .24-.08 1.2-.162 2.4-.234 3.6-.234.08 0 .16 0 .24.08 1.2.08 2.4.162 3.6.324 1.2.162 2.4.324 3.6.486.08 0 .16.08.24.08 1.2.162 2.4.324 3.6.486.08.08.16.08.24.162 1.2.162 2.4.324 3.6.486.08.08.16.162.24.162 1.2.324 2.4.486 3.6.648.08.08.16.162.24.162 1.12.324 2.24.486 3.36.648.08.08.16.162.24.162 1.04.324 2.08.486 3.12.648.08.08.16.162.24.162.96.324 1.92.486 2.88.648.08.08.16.162.24.162.88.324 1.76.486 2.64.648.08.08.16.162.24.162.8.324 1.6.486 2.4.648.08.08.16.162.24.162.72.324 1.44.486 2.16.648.08.08.16.162.24.162.64.324 1.28.486 1.92.648.08.08.16.162.24.162.56.324 1.12.486 1.68.648.08.08.16.162.24.162.48.324.96.486 1.44.648.08.08.16.162.24.162.4.324.8.486 1.2.648.08.08.16.162.24.162.32.324.64.486.96.648.08.08.16.162.24.162.24.324.48.486.72.648.08.08.16.162.24.162.16.324.32.486.48.648.08.08.16.162.24.162.08.324.16.486.24.648.08.08.16.162.24.324.08.162.08.324.16.486.08.08.16.162.24.324z" />
          </svg>
        </a>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>
  <script>
    (function () {
      var params = new URLSearchParams(window.location.search);
      var code = (params.get('code') || '').trim().toLowerCase();
      var el = document.getElementById('status-message');
      var heartEl = document.getElementById('status-heart');
      var sadEl = document.getElementById('status-sad');
      if (!code || code.length !== 7) {
        el.textContent = 'Invalid code.';
        return;
      }
      if (typeof firebase === 'undefined' || !firebase.firestore) {
        el.textContent = 'Could not load Firebase.';
        return;
      }
      firebase.firestore().collection('links').doc(code).get()
        .then(function (snap) {
          if (!snap.exists) {
            el.textContent = 'Invalid code.';
            return;
          }
          var data = snap.data();
          var name = (data.name || '').trim();
          var status = (data.status || '').toLowerCase();
          if (heartEl) heartEl.classList.remove('visible');
          if (sadEl) sadEl.classList.remove('visible');
          if (status === 'yes' || status === 'responded') {
            if (heartEl) heartEl.classList.add('visible');
            el.textContent = name ? name + ' responded yes.' : 'They said yes.';
          } else if (status === 'no') {
            if (sadEl) sadEl.classList.add('visible');
            el.textContent = name ? name + ' responded no.' : 'They said no.';
          } else {
            el.textContent = 'They haven\'t responded.';
          }
        })
        .catch(function () {
          el.textContent = 'Could not load status.';
        });
    })();
  </script>
</body>

</html>